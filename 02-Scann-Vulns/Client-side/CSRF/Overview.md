# Cross-site request forgery (CSRF)

## What is CSRF?

Cross-site request forgery (also known as CSRF) is a web security vulnerability that allows an attacker to induce users to perform actions that they do not intend to perform. It allows an attacker to partly circumvent the same origin policy, which is designed to prevent different websites from interfering with each other.  

## How does CSRF work?

For a CSRF attack to be possible, three key conditions must be in place:

### 1. A relevant action

> There is an action within the application that the attacker has a reason to induce.

### 2. Cookie-based session handling

> Performing the action involves issuing one or more HTTP requests, and the application relies solely on session cookies to identify the user who has made the requests.

### 3. No unpredictable request parameters

> The requests that perform the action do not contain any parameters whose values the attacker cannot determine or guess.

## Defences against CSRF

### CSRF tokens

> A CSRF token is a unique, secret, and unpredictable value that is generated by the server-side application and shared with the client.

#### Bypassing CSRF token validation

1. Validation of CSRF token depends on request method  
2. Validation of CSRF token depends on token being present  
3. CSRF token is not tied to the user session  
4. CSRF where token is not tied to user session (the application maintains a global pool of tokens)
5. CSRF token is tied to a non-session cookie (the applications do tie the CSRF token to a cookie, but not to the same cookie that is used to track sessions. )
6. CSRF token is simply duplicated in a cookie

### SameSite cookies

> SameSite is a browser security mechanism that determines when a website's cookies are included in requests originating from other websites. SameSite cookie restrictions provide partial protection against a variety of cross-site attacks, including CSRF, cross-site leaks, and some CORS exploits.

#### Bypassing SameSite cookie restrictions

### Referer-based validation

#### Bypassing Referer-based CSRF defenses